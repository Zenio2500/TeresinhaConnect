<div class="mb-4">
  <h1>Escala - <%= @grade.date.strftime("%d/%m/%Y") %></h1>
  <p style="color: var(--gray-600);">Detalhes da escala lit√∫rgica</p>
</div>

<div class="card">
  <div class="card-header">
    <h3 class="card-title">Informa√ß√µes da Celebra√ß√£o</h3>
    <div class="btn-group">
      <%= link_to "Editar", edit_grade_path(@grade), class: "btn btn-sm btn-warning" %>
      <button type="button" class="btn btn-sm btn-danger" onclick="showDeleteGradeModal()">Excluir</button>
      <%= link_to "Voltar", grades_path, class: "btn btn-sm btn-secondary" %>
    </div>
  </div>
  
  <div class="card-body">
    <ul class="detail-list">
      <li class="detail-list-item">
        <span class="detail-list-label">Data:</span>
        <span class="detail-list-value">
          <strong><%= @grade.date.strftime("%d/%m/%Y") %></strong>
          (<%= I18n.l(@grade.date, format: '%A') %>)
        </span>
      </li>
      
      <li class="detail-list-item">
        <span class="detail-list-label">Cor Lit√∫rgica:</span>
        <span class="detail-list-value">
          <% if @grade.liturgical_color.present? %>
            <span class="liturgical-color liturgical-<%= @grade.liturgical_color.downcase %>">
              <span class="liturgical-color-indicator"></span>
              <%= @grade.liturgical_color.capitalize %>
            </span>
          <% else %>
            N/A
          <% end %>
        </span>
      </li>
      
      <li class="detail-list-item">
        <span class="detail-list-label">Tempo Lit√∫rgico:</span>
        <span class="detail-list-value"><%= @grade.liturgical_time || 'N/A' %></span>
      </li>
      
      <li class="detail-list-item">
        <span class="detail-list-label">Solenidade:</span>
        <span class="detail-list-value">
          <% if @grade.is_solemnity %>
            <span class="badge badge-warning">Sim</span>
          <% else %>
            <span class="badge badge-secondary">N√£o</span>
          <% end %>
        </span>
      </li>
      
      <% if @grade.description.present? %>
        <li class="detail-list-item">
          <span class="detail-list-label">Descri√ß√£o:</span>
          <span class="detail-list-value"><%= @grade.description %></span>
        </li>
      <% end %>
      
      <li class="detail-list-item">
        <span class="detail-list-label">Cadastrada em:</span>
        <span class="detail-list-value"><%= @grade.created_at.strftime("%d/%m/%Y √†s %H:%M") %></span>
      </li>
    </ul>
  </div>
</div>

<% if @grade.reader_grades.any? %>
  <div class="card">
    <div class="card-header">
      <h3 class="card-title">Leitores Designados</h3>
    </div>
    
    <div class="card-body">
      <ul class="detail-list">
        <% 
          # Definir ordem das fun√ß√µes
          reading_order = ['1¬™ Leitura', 'Salmo', '2¬™ Leitura', 'Preces']
          
          # Ordenar reader_grades pela ordem definida
          sorted_reader_grades = @grade.reader_grades.sort_by do |rg|
            reading_order.index(rg.reader_type) || 999
          end
          
          sorted_reader_grades.each do |reader_grade|
        %>
          <li class="detail-list-item">
            <span class="detail-list-label"><%= reader_grade.reader_type %>:</span>
            <span class="detail-list-value">
              <strong><%= reader_grade.reader.user&.name || 'N/A' %></strong>
              <%= link_to "Ver Leitor", reader_path(reader_grade.reader), class: "btn btn-sm btn-secondary", style: "margin-left: 10px;" %>
            </span>
          </li>
        <% end %>
      </ul>
    </div>
  </div>
<% else %>
  <div class="card">
    <div class="card-body text-center" style="color: var(--gray-600); padding: var(--spacing-xl);">
      <p>Nenhum leitor designado para esta escala ainda.</p>
    </div>
  </div>
<% end %>

<!-- Modal de Confirma√ß√£o de Exclus√£o -->
<div id="delete-grade-modal" class="modal-overlay" style="display: none;">
  <div class="confirmation-modal">
    <div class="modal-header">
      <span class="modal-icon danger">üóëÔ∏è</span>
      <h3 class="modal-title">Confirmar Exclus√£o de Escala</h3>
    </div>
    <div class="modal-body">
      <p>Tem certeza que deseja excluir a escala de <strong><%= @grade.date.strftime("%d/%m/%Y") %></strong>?</p>
      <p>Esta a√ß√£o n√£o pode ser desfeita.</p>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeDeleteGradeModal()">Cancelar</button>
      <%= button_to "Confirmar Exclus√£o", grade_path(@grade), 
          method: :delete, 
          class: "btn btn-danger" %>
    </div>
  </div>
</div>

<script>
  function showDeleteGradeModal() {
    document.getElementById('delete-grade-modal').style.display = 'flex';
  }
  
  function closeDeleteGradeModal() {
    document.getElementById('delete-grade-modal').style.display = 'none';
  }
  
  document.getElementById('delete-grade-modal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeDeleteGradeModal();
    }
  });
  
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeDeleteGradeModal();
    }
  });
</script>
